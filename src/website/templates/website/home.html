{% extends 'website/base.html' %}
{% load website_extras %}

{% block title %}Home - My Neighbourhood{% endblock %}

{% block content %}
<h2>Latest Posts</h2>
<br>
{% if posts %}
    {% for post in posts %}
    <div class="post">
        <div class="category-badge category-{{ post.category }}">
            {{ post.get_category_display }}
        </div>
        <div class="post-header">
            <h3>{{ post.title }}</h3>
            {% if user.is_authenticated and user != post.author %}
                <div class="subscription-actions">
                    {% if subscription_status|get_item:post.author.id %}
                        <a href="{% url 'unsubscribe' post.author.id %}" class="btn btn-danger btn-sm">
                            Unsubscribe
                        </a>
                    {% else %}
                        <a href="{% url 'subscribe' post.author.id %}" class="btn btn-success btn-sm">
                            Subscribe
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
        <div class="user-info">
            By <a href="{% url 'user_profile' post.author.id %}">{{ post.author.username }}</a>
        </div>
        <div class="timestamp">
            Published: {{ post.scheduled_for|date:"F j, Y, g:i a" }}
        </div>
        <p>{{ post.content }}</p>
        {% if post.image %}
            <img src="{{ post.image.url }}" alt="Post image">
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    <p>No posts yet. Be the first to create one!</p>
{% endif %}

{% if user.is_authenticated %}
    <div style="margin-top: 20px;">
        <a href="{% url 'create_post' %}" class="btn btn-primary">Create New Post</a>
    </div>
{% else %}
    <div style="margin-top: 20px;">
        <p>Login to create posts and subscribe to other users!</p>
        <a href="{% url 'login' %}" class="btn btn-primary">Login</a>
        <a href="{% url 'register' %}" class="btn btn-success">Register</a>
    </div>
{% endif %}
{% endblock %} 